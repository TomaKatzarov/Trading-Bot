# CNN-LSTM HPO Configuration - Optional Hybrid Architecture
experiment_config:
  name: "HPO_CNN_LSTM_Production"
  stage: "HPO"
  purpose: "optimize_cnn_lstm_hybrid_architecture"
  n_trials: 50
  timeout_hours: 20

data_config:
  pregenerated_path: "data/training_data_v2_final"  # New enhanced dataset with full 23 features
  lookback_window: 24
  num_workers: 8

model_config:
  type: "cnn_lstm"
  
  # CNN parameters for feature extraction
  cnn_channels:
    type: "categorical"
    values: [[16, 32], [32, 64], [64, 128]]  # Progressive channel sizes
  cnn_kernel_size:
    type: "categorical"
    values: [3, 5]  # Temporal convolution window
  
  # LSTM parameters for sequence modeling
  lstm_hidden_size:
    type: "categorical"
    values: [64, 96, 128]
  lstm_num_layers:
    type: "categorical"
    values: [1, 2]
  
  # Regularization
  dropout:
    type: "float"
    low: 0.3
    high: 0.6
  
  # Attention mechanism
  attention_dim:
    type: "categorical"
    values: [32, 48, 64]

training_config:
  epochs: 100
  # Search space for training hyperparameters
  batch_size:
    type: "categorical"
    values: [64, 128, 256]
  learning_rate:
    type: "loguniform"
    low: 0.0001
    high: 0.002
  optimizer: "adamw"
  weight_decay:
    type: "float"
    low: 0.01
    high: 0.1
  gradient_clip_norm:
    type: "categorical"
    values: [0.5, 1.0, 2.0]
  
  # Early stopping
  early_stopping_patience: 15
  early_stopping_metric: "val_f1"
  
  # Loss function
  loss_function: "focal_loss"
  focal_alpha:
    type: "float"
    low: 0.15
    high: 0.45
  focal_gamma:
    type: "float"
    low: 1.5
    high: 3.0

lr_scheduler_config:
  type: "reduce_on_plateau"
  factor: 0.5
  patience:
    type: "int"
    low: 5
    high: 10
  mode: "max"

# Optimization objectives
optimization:
  direction: "maximize"
  metric: "val_f1"
  
  secondary_objectives:
    - name: "overfitting_gap"
      weight: -0.3
      formula: "train_f1 - val_f1"
    
    - name: "recall_weight"
      weight: 0.5
      formula: "val_recall"

# Pruning strategy
pruning:
  enabled: true
  patience: 10
  min_epochs: 15